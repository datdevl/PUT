name: Download and Move Multiple Videos (Random Names)

on:
  workflow_dispatch:

jobs:
  fetch-move:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repo
        uses: actions/checkout@v3

      - name: Install gdown and ffmpeg
        run: |
          pip install gdown
          sudo apt update
          sudo apt install -y ffmpeg

      - name: Download and compress multiple videos
        run: |
          mkdir -p temp TAINGUYEN

          # Danh s√°ch c√°c ID video Google Drive
          ids=(
            1BWMlzamC5x2YueKsVsGvF2DLNdmlo3wG
            1MCKB_acSDkGPNMGs3-Ah0Jo-3c6NQguz
            1-1Xw8-j_GTrddspVu2pL6ACIOJ3zlEyY7u
            1yUCW7S_8SOcLsAqMcaDyA5IvBCU2aKld
          )

          for id in "${ids[@]}"; do
            echo "üì• ƒêang t·∫£i video t·ª´ ID: $id"
            random_name=$(cat /dev/urandom | tr -dc 'a-z0-9' | fold -w 10 | head -n 1)

            # T·∫£i video v·ªõi timeout 5 ph√∫t v√† suppress warning
            timeout 300 gdown --id "$id" --fuzzy --quiet -O "temp/$random_name.mp4"

            if [ -f "temp/$random_name.mp4" ]; then
              echo "üéûÔ∏è N√©n video: $random_name"
              ffmpeg -y -i "temp/$random_name.mp4" -vcodec libx264 -acodec aac -crf 30 -preset fast "TAINGUYEN/video_$random_name.mp4"
            else
              echo "‚ùå L·ªói t·∫£i video t·ª´ ID: $id"
            fi
          done

      - name: Commit and push
        run: |
          git config user.name "github-actions"
          git config user.email "github-actions@github.com"
          git pull --rebase
          git add TAINGUYEN/
          git commit -m "Add random-named videos"
          git push
